<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Dashboard - Compact Table</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --color-blue: #3b82f6;
            --color-green: #22c55e;
            --color-red: #ef4444;
            --color-gray-bar: #9ca3af;
            --color-orange: #f97316;
            --color-purple: #a855f7;
            
            --btn-pink: #ec4899;
            --btn-yellow: #fbbf24; 
            --btn-red: #f43f5e;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0;
            padding: 24px;
            box-sizing: border-box;
        }

        /* --- Header & Layout --- */
        .header h1 { font-size: 24px; font-weight: 700; margin: 0 0 20px 0; color: #1f2937; }

        /* --- Filter Area --- */
        .top-filters { display: grid; grid-template-columns: 1fr 1fr 1fr 2fr; gap: 16px; margin-bottom: 16px; }
        .filter-box label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .input-std { width: 100%; padding: 9px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; background: #fff; box-sizing: border-box; }

        .threshold-bar {
            background: var(--bg-card); padding: 12px 16px; border-radius: 8px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; align-items: center; flex-wrap: wrap; gap: 12px; margin-bottom: 24px;
        }
        .threshold-label { font-weight: 700; font-size: 14px; margin-right: 4px; }
        .threshold-input-group { display: flex; align-items: center; font-size: 14px; color: var(--text-secondary); }
        .threshold-input { width: 50px; padding: 6px; margin: 0 6px; border: 1px solid #d1d5db; border-radius: 4px; text-align: center; }

        .btn { padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-pink { background: var(--btn-pink); color: white; }
        .btn-outline { background: white; border: 1px solid #d1d5db; color: #374151; }
        .btn-yellow { background: #eab308; color: white; }
        .btn-red { background: var(--btn-red); color: white; }
        .btn-export { margin-left: auto; border: 1px solid #d1d5db; background: white; color: #374151; display: flex; align-items: center; gap: 6px; }

        /* --- KPI Grid --- */
        .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 24px; }
        @media (min-width: 1200px) { .kpi-grid { grid-template-columns: 1fr 1fr 1fr 1fr 1.5fr; } }
        @media (max-width: 1199px) { .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); } }

        .card { background: var(--bg-card); border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; min-height: 100px; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .card-title { font-size: 14px; color: var(--text-secondary); font-weight: 500; }
        .card-value { font-size: 30px; font-weight: 700; color: var(--text-primary); line-height: 1.2; }
        .icon-badge { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        .icon-blue { background: #dbeafe; color: var(--color-blue); }
        .icon-orange { background: #ffedd5; color: var(--color-orange); }
        .icon-red { background: #fee2e2; color: var(--color-red); }
        .icon-green { background: #dcfce7; color: var(--color-green); }
        .icon-purple { background: #f3e8ff; color: var(--color-purple); }

        /* Status Bar in KPI Card */
        .status-header { display: flex; justify-content: space-between; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .progress-container { display: flex; height: 16px; border-radius: 4px; overflow: hidden; margin-bottom: 12px; font-size: 10px; color: white; font-weight: 700; line-height: 16px; text-align: center; }
        .prog-green { background: var(--color-green); width: 49%; }
        .prog-red { background: var(--color-red); width: 10%; }
        .prog-gray { background: #6b7280; width: 41%; }
        .legend-row { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* --- Chart Section --- */
        .chart-card { background: var(--bg-card); border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 24px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-title { font-size: 18px; font-weight: 700; }
        .chart-sub { font-size: 13px; color: var(--text-secondary); }
        .chart-legend-custom { display: flex; justify-content: center; gap: 20px; margin-top: 15px; font-size: 12px; color: #4b5563; }
        .legend-box { width: 12px; height: 12px; border-radius: 3px; margin-right: 5px; display: inline-block; vertical-align: middle; }

        /* --- Table Section --- */
        .table-card { background: var(--bg-card); border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow-x: auto; }
        /* Tabelle passt sich nun besser an, min-width reduziert */
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: left; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; padding: 12px 16px; border-bottom: 1px solid var(--border-color); }
        td { padding: 16px; border-bottom: 1px solid #f3f4f6; font-size: 14px; vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        .po-id { font-weight: 700; color: var(--text-primary); display: block; }
        .po-name { font-size: 13px; color: var(--text-secondary); }
        .badge { padding: 4px 10px; border-radius: 99px; font-size: 11px; font-weight: 700; text-transform: uppercase; display: inline-block;}
        .badge-progress { background: #dbeafe; color: #1e40af; }
        .badge-delayed { background: #fee2e2; color: #991b1b; }
        .badge-completed { background: #dcfce7; color: #166534; }

        /* Responsive Design */
        @media (max-width: 768px) {
            body { padding: 16px; }
            .header h1 { font-size: 20px; }
            .top-filters { grid-template-columns: 1fr; gap: 12px; }
            .threshold-bar { flex-direction: column; align-items: stretch; }
            .threshold-bar .btn { width: 100%; }
            .kpi-grid { grid-template-columns: 1fr; gap: 16px; }
            .card-value { font-size: 24px; }
            .chart-card { padding: 16px; }
            .table-card { padding: 12px; }
            table { min-width: 500px; font-size: 12px; }
            td, th { padding: 10px; }
        }

    </style>
</head>
<body>

    <div class="header"><h1>Production Dashboard</h1></div>

    <div class="top-filters">
        <div class="filter-box"><label>Date Range</label><select class="input-std"><option>All Time</option></select></div>
        <div class="filter-box"><label>Customer</label><select class="input-std"><option>All Customers</option></select></div>
        <div class="filter-box"><label>Machine</label><select class="input-std"><option>All Machines</option></select></div>
        <div class="filter-box"><label>Search</label><input type="text" class="input-std" placeholder="Order #, Product name..."></div>
    </div>

    <div class="threshold-bar">
        <span class="threshold-label">Threshold Filters:</span>
        <div class="threshold-input-group">Delay > <input type="text" class="threshold-input"> %</div>
        <div class="threshold-input-group">Time Overrun > <input type="text" class="threshold-input"> hrs</div>
        <div class="threshold-input-group">Cost Overrun > <input type="text" class="threshold-input"> $</div>
        <button class="btn btn-pink">Apply Filters</button>
        <button class="btn btn-outline">Reset</button>
        <button class="btn btn-yellow">Show All Delayed Orders</button>
        <button class="btn btn-red">Show All Cost Overruns</button>
        <button class="btn btn-export">Export CSV</button>
    </div>

    <div class="kpi-grid">
        <div class="card"><div class="card-header"><span class="card-title">Total Orders</span><div class="icon-badge icon-blue">üìä</div></div><span class="card-value">30</span></div>
        <div class="card"><div class="card-header"><span class="card-title">Running Orders</span><div class="icon-badge icon-orange">‚öôÔ∏è</div></div><span class="card-value">7</span></div>
        <div class="card"><div class="card-header"><span class="card-title">Delayed Operations</span><div class="icon-badge icon-red">‚ö†Ô∏è</div></div><span class="card-value">11</span></div>
        <div class="card"><div class="card-header"><span class="card-title">Total Time Savings</span><div class="icon-badge icon-green">üïí</div></div><span class="card-value">68.2h</span></div>
        <div class="card">
            <div class="status-header"><span style="font-weight:600; color:#111827;">Production Status</span><span>79 ops</span><div class="icon-badge icon-purple" style="width:24px; height:24px;">üõ°Ô∏è</div></div>
            <div class="progress-container"><div class="prog-green">49%</div><div class="prog-red">10%</div><div class="prog-gray">41%</div></div>
            <div class="legend-row">
                <div class="legend-item"><div class="dot" style="background:#22c55e;"></div> On Time (39)</div>
                <div class="legend-item"><div class="dot" style="background:#ef4444;"></div> Delayed (8)</div>
                <div class="legend-item"><div class="dot" style="background:#6b7280;"></div> Pending (32)</div>
            </div>
        </div>
    </div>

    <div class="chart-card">
        <div class="chart-header">
            <div class="chart-title">Time Deviation Analysis (Orders with Actual Time)</div>
            <div class="chart-sub">Showing 8 orders with recorded time</div>
        </div>
        <div style="height: 350px; position: relative; width: 100%;">
            <canvas id="mainChart"></canvas>
        </div>
        <div class="chart-legend-custom">
            <div><span class="legend-box" style="background: #3b82f6;"></span>Planned Time</div>
            <div><span class="legend-box" style="background: #ef4444;"></span>Actual Time (Over)</div>
            <div><span class="legend-box" style="background: #22c55e;"></span>Actual Time (Under/On Time)</div>
            <div><span class="legend-box" style="background: #9ca3af;"></span>Pending Time</div>
        </div>
    </div>

    <div class="table-card">
        <h3 class="table-title">Production Orders</h3>
        <table>
            <thead>
                <tr>
                    <th>Order Details</th>
                    <th>Customer</th>
                    <th>Status</th>
                    <th>Total Value</th>
                    <th>Due Date</th>
                    </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="po-id">PO-2025-001</span><span class="po-name">Business Cards</span></td>
                    <td>ABC Manufacturing</td>
                    <td><span class="badge badge-progress">In Progress</span></td>
                    <td>$2,696</td>
                    <td>Nov 6, 2025</td>
                </tr>
                <tr>
                    <td><span class="po-id">PO-2025-002</span><span class="po-name">Tri-fold Brochures</span></td>
                    <td>XYZ Industries</td>
                    <td><span class="badge badge-delayed">Delayed</span></td>
                    <td>$3,531</td>
                    <td>Sep 16, 2025</td>
                </tr>
                <tr>
                    <td><span class="po-id">PO-2025-003</span><span class="po-name">Product Catalogs</span></td>
                    <td>Global Print Solutions</td>
                    <td><span class="badge badge-completed">Completed</span></td>
                    <td>$1,969</td>
                    <td>Sep 11, 2025</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // --- Daten f√ºr das Diagramm (8 Eintr√§ge, korrekte Logik) ---
        const rawData = [
            { id: 'PO-2025-001', name: 'Business Cards', planned: 2.0, actual: 2.0, pending: 0 },
            { id: 'PO-2025-002', name: 'Tri-fold B...', planned: 6.0, actual: 5.5, pending: 1.7 }, 
            { id: 'PO-2025-003', name: 'Product Ca...', planned: 7.8, actual: 7.5, pending: 0 },
            { id: 'PO-2025-015', name: 'Generic Pr...', planned: 3.2, actual: 3.5, pending: 1.2 }, 
            { id: 'PO-2025-019', name: 'Generic Pr...', planned: 5.2, actual: 3.0, pending: 0.5 },
            { id: 'PO-2025-016', name: 'Generic Pr...', planned: 4.3, actual: 4.9, pending: 0 },
            { id: 'PO-2025-H003', name: 'Brochures', planned: 4.0, actual: 3.2, pending: 0 },
            { id: 'PO-2025-H004', name: 'Catalogs', planned: 8.2, actual: 7.0, pending: 0.7 } 
        ];

        const processedData = rawData.map(d => {
            const total = d.actual + d.pending;
            const deviation = total - d.planned;
            let pctVal = Math.round((deviation / d.planned) * 100);
            let pctStr = pctVal > 0 ? `+${pctVal}%` : `${pctVal}%`;
            if (pctVal === 0) pctStr = "0%";
            const isOverrun = total > (d.planned + 0.05);

            return {
                label: [d.id.replace('PO-2025-', ''), d.name, `(${pctStr})`], 
                planned: d.planned,
                actual: d.actual,
                pending: d.pending,
                color: isOverrun ? '#ef4444' : '#22c55e'
            };
        });

        const labels = processedData.map(d => d.label);
        const dataPlanned = processedData.map(d => d.planned);
        const dataActual = processedData.map(d => d.actual);
        const dataPending = processedData.map(d => d.pending);
        const bgColorsActual = processedData.map(d => d.color);

        const ctx = document.getElementById('mainChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Planned Time',
                        data: dataPlanned,
                        backgroundColor: '#3b82f6',
                        borderRadius: 4, 
                        barPercentage: 0.5,
                        categoryPercentage: 0.7,
                        stack: 'planned',
                        order: 1
                    },
                    {
                        label: 'Actual Time',
                        data: dataActual,
                        backgroundColor: bgColorsActual,
                        borderRadius: {topLeft: 0, topRight: 0, bottomLeft: 4, bottomRight: 4},
                        borderSkipped: false,
                        barPercentage: 0.5,
                        categoryPercentage: 0.7,
                        stack: 'actual',
                        order: 2
                    },
                    {
                        label: 'Pending Time',
                        data: dataPending,
                        backgroundColor: '#9ca3af',
                        borderRadius: {topLeft: 4, topRight: 4, bottomLeft: 0, bottomRight: 0},
                        borderSkipped: false,
                        barPercentage: 0.5,
                        categoryPercentage: 0.7,
                        stack: 'actual',
                        order: 3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) { label += context.parsed.y + 'h'; }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 9,
                        stacked: true, 
                        ticks: { stepSize: 1, callback: v => v + 'h', font: { size: 10, family: 'Inter' } },
                        grid: { borderDash: [2, 2], color: '#f3f4f6' }
                    },
                    x: {
                        stacked: true, 
                        grid: { display: false },
                        ticks: { font: { size: 10, family: 'Inter' } }
                    }
                }
            }
        });
    </script>
</body>
</html>